@page "/dashboard"
@attribute [Authorize(Roles = $"{Roles.Admin},{Roles.Reviewer}")]
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

<PageTitle>Admin Dashboard</PageTitle>
<HgPageHeading>Dashboard</HgPageHeading>

<MudGrid>
    <MudItem xs="6" lg="6">
        <MudPaper Class="my-2 pa-4" Outlined="true">
            <MudText Align="Align.Center" Typo="Typo.subtitle1" Style="font-weight:bold">Registered Users</MudText>
            <MudText Align="Align.Center" Typo="Typo.subtitle1" Style="font-weight:bold">@TotalRegisteredUsers</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="6" lg="6">
        <MudPaper Class="my-2 pa-4" Outlined="true">
            <MudText Align="Align.Center" Typo="Typo.subtitle1" Style="font-weight:bold">Dependents</MudText>
            <MudText Align="Align.Center" Typo="Typo.subtitle1" Style="font-weight:bold">@TotalDependents</MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

<MudGrid Class="my-3">
    <MudItem xs="6" lg="3">
        <MudDateRangePicker Mindate="@MinimumDateTime" MaxDate="@MaximumDateTime" @ref="SelectedDateRangePicker" Label="Select Date Range" @bind-DateRange="SelectedDateRange" Color="Color.Success" Style="font-weight:bold">
            <PickerActions>
                <MudButton Class="mr-auto align-self-start" OnClick="@(() => SelectedDateRangePicker.Clear())">Clear</MudButton>
                <MudButton OnClick="@(() => SelectedDateRangePicker.Close(false))">Cancel</MudButton>
                <MudButton Color="Color.Primary" OnClick="@(() => DispatchRecurringUserActionWithDateChanged())">Ok</MudButton>
            </PickerActions>
        </MudDateRangePicker>
    </MudItem>
</MudGrid>

<MudGrid Class="my-3">
    <MudItem xs="6" lg="3">
        <HgTextField T="int" Label="Unique Days" Required="@true" Style="font-weight:bold" @bind-Value="UniqueDays" />
    </MudItem>
</MudGrid>

<MudGrid>
    <MudItem xs="6" lg="6">
        <MudPaper Class="my-2 pa-4" Outlined="true">
            <MudText Align="Align.Center" Typo="Typo.subtitle1" Style="font-weight:bold">User Count</MudText>
            <MudText Align="Align.Center" Typo="Typo.subtitle1" Style="font-weight:bold">@TotalUniqueUsers </MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

<MudText Class="my-3" Typo="Typo.subtitle1" Style="font-weight:bold">Rating Summary</MudText>
<MudGrid>
    <MudItem xs="1" lg="1" Class="d-flex justify-center justify-center  align-center">
         <MudText Class="my-3" Typo="Typo.h4" Style="font-weight:bold">@RatingAverage</MudText>
    </MudItem>
    <MudItem xs="6" lg="10">
        <HgRatingDetails IconIndex="5"  RatingSummary="@RatingSummary"/>
        <HgRatingDetails IconIndex="4"  RatingSummary="@RatingSummary"/>
        <HgRatingDetails IconIndex="3"  RatingSummary="@RatingSummary"/>
        <HgRatingDetails IconIndex="2"  RatingSummary="@RatingSummary"/>
        <HgRatingDetails IconIndex="1"  RatingSummary="@RatingSummary"/>
    </MudItem>
</MudGrid>
<MudGrid>
    <MudItem  xs="6" lg="6">
        <MudText Class="my-3 d-flex justify-end" Typo="Typo.subtitle2">@RatingCount Ratings</MudText>
    </MudItem>
</MudGrid>

<MudGrid>
    <MudItem xs="12" lg="12">
        <MudText Class="mt-3" Typo="Typo.subtitle1" Style="font-weight:bold">Daily Data</MudText>
        <MudTable Class="mt-3" Items="@TableData" HorizontalScrollbar="true" Striped="true" Dense="true">
            <HeaderContent>
                <MudTh>Date</MudTh>
                <MudTh>Registered</MudTh>
                <MudTh>Logged In</MudTh>
                <MudTh>Dependents</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Date">@context.DailyDateTime.ToString("yyyy-MM-dd")</MudTd>
                <MudTd DataLabel="Registered">@context.TotalRegisteredUsers</MudTd>
                <MudTd DataLabel="Logged In">@context.TotalLoggedInUsers</MudTd>
                <MudTd DataLabel="Dependents">@context.TotalDependents</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    </MudItem>
</MudGrid>

